
<!DOCTYPE html>
<html class="no-js" lang="">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">

  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <!-- <link rel="stylesheet" href="css/normalize.css"> -->
  <link rel="stylesheet" href="css/main.css">
  <link rel="manifest" href="site.webmanifest">
  <link href="https://fonts.googleapis.com/css?family=Cabin+Sketch|Jua|Open+Sans" rel="stylesheet">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
  <script src="http://js.leapmotion.com/leap-0.6.3.min.js"></script>
  <script src="https://unpkg.com/konva@2.4.2/konva.min.js"></script>
  <script src="js/jscolor.js"></script>
  <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>

  <img id="pencil-cursor" src="img/pencil-cursor.png" style="display: none">
</head>

<body>
  <h1>Handimations</h1>

  <button id="color" class="jscolor {valueElement:'chosen-value', onFineChange:'setStrokeColor(this)'}">
    <i class="fas fa-palette fa-3x"></i>
  </button>

  <script>
     function vectorToString(vector, digits) {
       if (typeof digits === "undefined") {
         digits = 1;
       }
       return "(" + vector[0].toFixed(digits) + ", "
                  + vector[1].toFixed(digits) + ", "
                  + vector[2].toFixed(digits) + ")";
     }

     function togglePause() {
       paused = !paused;
       if (paused) {
         document.getElementById("pause").innerText = "Resume";
       } else {
         document.getElementById("pause").innerText = "Pause";
       }
     }

     function pauseForGestures() {
       if (document.getElementById("pauseOnGesture").checked) {
         pauseOnGesture = true;
       } else {
         pauseOnGesture = false;
       }
     }

     //set color from color picker
     function setStrokeColor(picker) {
       curColor = "#" + picker.toString();
     }
  </script>

  <div id="container"></div>

  <script>
    //set up width and height on canvas
    var width = window.innerWidth;
    var height = window.innerHeight - 25;

    // first we need Konva core things: stage and layer
    var stage = new Konva.Stage({
      container: 'container',
      width: width,
      height: height
    });

    var layer = new Konva.Layer();
    stage.add(layer);

    // Create LeapMotion controller, and related objects
    var controller = new Leap.Controller();

    var curColor = "#000000";

    // then we are going to draw into special canvas element
    var canvas = document.createElement('canvas');
    canvas.width = stage.width()/2;
    canvas.height = stage.height()/2;

    // created canvas we can add to layer as "Konva.Image" element
    var image = new Konva.Image({
      image: canvas,
      x: stage.width()/10,
      y: stage.height()/10,
      stroke: 'blue',
      shadowBlur: 5
    });
    layer.add(image);
    stage.draw();

    //get access to context element
    var context = canvas.getContext('2d');
    context.strokeStyle = curColor;
    context.lineJoin = "round";
    context.lineWidth = 5;

    var isPaint = false;
    var lastPointerPosition;
    var mode = 'brush';

    // now we need to bind some events
    // we need to start drawing on mousedown
    // and stop drawing on mouseup
    image.on('mousedown touchstart', function () {
      isPaint = true;
      lastPointerPosition = stage.getPointerPosition();

    });

    // will it be better to listen move/end events on the window?

    stage.addEventListener('mouseup touchend', function () {
      isPaint = false;
    });

    // and core function - drawing
    stage.addEventListener('mousemove touchmove', function () {
      if (!isPaint) {
        return;
      }

      if (mode === 'brush') {
        context.globalCompositeOperation = 'source-over';
      }
      if (mode === 'eraser') {
        context.globalCompositeOperation = 'destination-out';
      }
      context.beginPath();

      var localPos = {
        x: lastPointerPosition.x - image.x(),
        y: lastPointerPosition.y - image.y()
      };
      context.moveTo(localPos.x, localPos.y);
      var pos = stage.getPointerPosition();
      localPos = {
        x: pos.x - image.x(),
        y: pos.y - image.y()
      };
      context.lineTo(localPos.x, localPos.y);
      context.closePath();
      context.strokeStyle = curColor;
      context.stroke();

      lastPointerPosition = pos;
      layer.batchDraw();
    });

  </script>

  <script src="js/plugins.js"></script>
  <script src="js/main.js"></script>

  <div id="main">
     <h3>Finger and tool data:</h3>
     <div id="pointableData"></div>
     <div style="clear:both;"></div>
  </div>


</body>
</html>
